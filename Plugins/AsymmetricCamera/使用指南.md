# 非对称相机插件使用指南

## 概述

这个插件为Unreal Engine 5.4实现了非对称视锥体（Off-Axis / Asymmetric Frustum）相机投影，类似Unity中的Off-Axis Projection功能。

## 主要功能

✅ **已实现的功能：**

### 1. 编辑器可视化
- **投影屏幕可视化**：在编辑器视口中实时显示投影屏幕的边界（绿色线框）
- **视锥体可视化**：显示从相机到屏幕四个角的视锥体线（黄色）
- **法线方向**：显示屏幕的法线方向（红色箭头）
- **近裁剪平面**：显示近裁剪平面位置（橙色）
- **对角线辅助线**：显示屏幕的对角线（蓝色）
- **自动更新**：在编辑器中移动组件时实时更新可视化

### 2. 运行时调试
- 通过 `bShowDebugFrustum` 属性启用运行时调试可视化
- 显示屏幕角点标签（BL, BR, TL, TR）
- 显示相机位置（黄色球体）
- 显示从相机到屏幕的连线

### 3. 灵活的屏幕定义
- **三点定义法**：通过左下、右下、左上三个角点定义屏幕
- **平面定义法**：通过中心点、宽度、高度、法线定义屏幕
- **坐标模式**：支持相对坐标和世界坐标两种模式

### 4. 立体渲染支持
- 内置眼间距（Eye Separation）参数
- 支持左眼/右眼/中心视图

### 5. 蓝图友好
- 所有核心功能都暴露给蓝图
- 支持蓝图节点调用

## 使用方法

### 方法一：使用 AsymmetricCameraActor（推荐）

1. **添加到场景**
   - 在Content Browser中搜索 `AsymmetricCameraActor`
   - 拖拽到场景中

2. **配置投影屏幕**
   ```
   在Details面板中：
   Asymmetric Camera → Projection Screen
   - Bottom Left: 屏幕左下角位置
   - Bottom Right: 屏幕右下角位置
   - Top Left: 屏幕左上角位置
   - Near Clip: 近裁剪面距离
   - Far Clip: 远裁剪面距离
   ```

3. **启用可视化**
   ```
   Asymmetric Camera → bShowDebugFrustum = true
   ```
   或在编辑器中选中组件即可自动显示可视化

4. **设置追踪目标**（可选）
   ```
   Asymmetric Camera → Tracked Actor = YourPlayerCamera
   ```
   设置后，相机会自动跟踪指定Actor的位置作为眼睛位置

5. **查看输出**
   - 渲染结果会输出到 `Render Target` 属性指定的渲染目标
   - 可以将Render Target应用到Material上显示

### 方法二：使用 AsymmetricCameraComponent

添加组件到任意Actor并调用 `Calculate Off Axis Projection` 函数获取自定义投影矩阵。

## 配置示例

### 示例1：2米宽 × 1.5米高的投影屏幕

**使用三点定义**（相对坐标，屏幕在组件前方100cm）：
```
Bottom Left:  (100, -100, -75)
Bottom Right: (100,  100, -75)
Top Left:     (100, -100,  75)
```

**使用平面定义**（蓝图节点）：
```blueprint
Set Screen From Plane
  Center: (100, 0, 0)
  Width: 200
  Height: 150
  Normal: (1, 0, 0)  // 朝向+X
```

### 示例2：CAVE系统多面投影

为每个投影面创建一个 `AsymmetricCameraActor`：

**前墙**：
```
Bottom Left:  (200, -150, 0)
Bottom Right: (200,  150, 0)
Top Left:     (200, -150, 200)
```

**左墙**：
```
Bottom Left:  (-150, -200, 0)
Bottom Right: ( 150, -200, 0)
Top Left:     (-150, -200, 200)
```

**地面**：
```
Bottom Left:  (-150, -200, 0)
Bottom Right: ( 150, -200, 0)
Top Left:     (-150,  200, 0)
```

## 编辑器可视化说明

当选中含有 `AsymmetricCameraComponent` 的Actor时，编辑器会自动显示：

- **绿色线框**：投影屏幕边界
- **蓝色对角线**：帮助识别屏幕中心
- **红色箭头**：屏幕法线方向（指向观看者）
- **黄色线条**：从相机位置到屏幕四角的视锥体
- **黄色球体**：相机/眼睛位置
- **橙色线框**：近裁剪平面
- **白色点**：屏幕四个角点

这些可视化元素帮助你在编辑器中精确调整屏幕位置和方向。

## 应用场景

### 1. CAVE / Powerwall 系统
配置多个相机，每个对应一个投影面，实现沉浸式虚拟环境。

### 2. 投影映射
定义匹配物理表面的投影屏幕，用于建筑可视化或艺术装置。

### 3. 非对称显示
为多显示器设置或特殊显示配置创建非对称投影。

### 4. Fishtank VR
在标准显示器上实现桌面VR，配合头部追踪创建3D"窗口"效果。

## 常见问题

**Q: 为什么看不到编辑器可视化？**
- 确保选中了包含AsymmetricCameraComponent的Actor
- 或启用 `bShowDebugFrustum` 属性
- 检查屏幕坐标是否在视口范围内

**Q: 投影看起来不对？**
- 启用 `bShowDebugFrustum` 检查屏幕位置
- 确认近远裁剪平面设置合理
- 检查追踪的Actor位置是否在屏幕前方

**Q: 性能问题？**
- 降低Render Target分辨率
- 如果眼睛位置固定，禁用 `bUpdateProjectionEveryFrame`
- 检查Scene Capture设置

## 技术原理

本插件实现了Robert Kooima的"通用透视投影"算法：

1. 在3D空间中定义投影屏幕平面
2. 计算屏幕的正交基
3. 根据眼睛位置投影屏幕角点
4. 构建非对称视锥体投影矩阵

该算法确保渲染的透视与观看者眼睛和显示表面的物理关系相匹配。

## 参考资料

- Robert Kooima: "Generalized Perspective Projection"
- [GitHub: fweidner/UE4-Plugin-OffAxis](https://github.com/fweidner/UE4-Plugin-OffAxis)
- [Medium: Off-axis projection in Unity](https://medium.com/try-creative-tech/off-axis-projection-in-unity-1572d826541e)
- [Wikibooks: Projection for Virtual Reality](https://en.wikibooks.org/wiki/Cg_Programming/Unity/Projection_for_Virtual_Reality)

## 下一步

1. 在场景中添加 `AsymmetricCameraActor`
2. 启用 `bShowDebugFrustum` 查看可视化
3. 调整屏幕位置和大小
4. 设置追踪目标（可选）
5. 将Render Target应用到材质上显示结果

祝你使用愉快！
